(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[638],{1181:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>k});var t=a(8045),s=a(5177),r=a(7694),i=a(8247),n=a(6445),c=a(1574),o=a(6686),d=a(8365),u=a(6389),h=a(2989),x=a(9062),m=a(4234),v=a(8225),b=a(1682),g=a(3677),f=a(7803),p=a(7148);let j=[{value:"wanx-style-repaint-v1",label:"通用图像编辑",description:"通义万相-通用图像编辑",icon:"/image/Group.svg"}],N=[{value:"0",label:"复古漫画"},{value:"1",label:"3D童话"},{value:"2",label:"二次元"},{value:"3",label:"小清新"},{value:"4",label:"未来科技"},{value:"5",label:"国画古风"},{value:"6",label:"将军百战"},{value:"7",label:"炫彩卡通"},{value:"8",label:"清雅国风"},{value:"9",label:"喜迎新年"},{value:"14",label:"国风工笔"},{value:"15",label:"恭贺新禧"},{value:"30",label:"童话世界"},{value:"31",label:"黏土世界"},{value:"32",label:"像素世界"},{value:"33",label:"冒险世界"},{value:"34",label:"日漫世界"},{value:"35",label:"3D世界"},{value:"36",label:"二次元世界"},{value:"37",label:"手绘世界"},{value:"38",label:"蜡笔世界"},{value:"39",label:"冰箱贴世界"},{value:"40",label:"吧唧世界"}],y=[{id:1,src:"/image/demo1.jpeg"},{id:2,src:"/image/demo2.jpeg"},{id:3,src:"/image/demo3.jpeg"}],w=[1,2,3,4];function k(){let[e,l]=(0,s.useState)("wanx-style-repaint-v1"),[a,k]=(0,s.useState)("0"),[C,z]=(0,s.useState)(1),[S,A]=(0,s.useState)(null),[D,R]=(0,s.useState)(!1),[L,U]=(0,s.useState)(y),[I,E]=(0,s.useState)(null),[P,O]=(0,s.useState)(0),{formattedDuration:F,start:M,stop:W}=(0,p.g)(),$=async()=>{if(0===L.length)return;let e=L[P];if(e)try{E(null),await (0,g.Rb)(e.src,"ai-image-".concat(e.id,"-").concat(Date.now(),".jpg"))}catch(e){console.error("下载失败:",e),E("下载失败，请重试")}},_=async()=>{let l=(()=>{if(!S)return"请先上传参考图片";if(S.width&&S.height){let{width:e,height:l}=S;if(e<256||e>3240||l<256||l>3240)return"图片尺寸必须在".concat(256,"\xd7").concat(256,"到").concat(3240,"\xd7").concat(3240,"像素之间，当前尺寸：").concat(e,"\xd7").concat(l)}return e?a?C<1||C>4?"输出数量必须在1-4之间":null:"请选择风格样式":"请选择模型"})();if(l)return void E(l);let t=j.find(l=>l.value===e);if(!t)return void E("模型配置错误");if(!S)return void E("请先上传参考图片");R(!0),M(),E(null);try{let e=await (0,f.Ho)({model:t.value,imageUrl:S.base64,outputCount:C,styleIndex:parseInt(a,10)});e.success&&e.data?(U(e.data),O(0)):E(e.error||"生成图像失败")}catch(e){E(e instanceof Error?e.message:"生成图像时发生未知错误")}finally{R(!1),W()}};return(0,t.jsxs)("div",{className:"bg-[#0D0D12] min-h-screen text-white",children:[(0,t.jsx)(r.A,{}),(0,t.jsx)(i.A,{}),(0,t.jsx)("main",{className:"ml-20 pt-14",children:(0,t.jsxs)("div",{className:"flex h-[calc(100vh-56px)] p-4 gap-4",children:[(0,t.jsxs)("div",{className:"w-[380px] bg-[#24222D] p-4 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-4",children:[(0,t.jsx)("h1",{className:"text-xl",children:"图像转图像AI"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"模型"}),(0,t.jsx)(v.t,{options:j,value:e,onValueChange:l,variant:"dark",size:"lg",renderTrigger:e=>e?(0,t.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center",children:(0,t.jsx)(h.default,{src:e.icon,alt:e.label,unoptimized:!0,width:24,height:24})}),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("p",{className:"text-sm text-white",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})]}):null,renderItem:e=>(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-md bg-gray-700 flex items-center justify-center",children:(0,t.jsx)(h.default,{src:e.icon,alt:e.label,unoptimized:!0,width:24,height:24})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})]})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"参考图片"}),(0,t.jsx)(b.D,{onImageUpload:e=>{A(e),E(null)},onImageRemove:()=>{A(null),E(null)},uploadedImage:S,disabled:D,maxSize:10})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"风格样式"}),(0,t.jsx)(v.t,{options:N,value:a,onValueChange:k,variant:"dark",size:"lg",renderTrigger:e=>e?(0,t.jsx)("div",{className:"py-1",children:(0,t.jsx)("p",{className:"text-sm text-white",children:e.label})}):null,renderItem:e=>(0,t.jsx)("div",{children:(0,t.jsx)("p",{className:"text-white",children:e.label})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"输出图像数量"}),(0,t.jsx)("div",{className:"grid grid-cols-4 gap-2",children:w.map(e=>(0,t.jsx)(x.$,{disabled:e>1,variant:C===e?"default":"outline",onClick:()=>z(e),className:C===e?"bg-primary hover:bg-primary/90":"bg-[#383842] border-[#4a4a54] hover:bg-[#4a4a54] hover:text-white",children:e},e))})]}),(0,t.jsxs)("div",{className:"flex justify-between text-sm text-gray-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:"所需额度:"}),(0,t.jsx)(n.A,{className:"w-4 h-4"})]}),(0,t.jsxs)("span",{className:"text-white",children:[15*C," 额度"]})]})]}),I&&(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 flex items-start gap-2",children:[(0,t.jsx)(c.A,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),(0,t.jsx)("div",{className:"text-sm text-red-400",children:I})]}),(0,t.jsx)("div",{className:"pt-4 border-t border-gray-700",children:(0,t.jsxs)(x.$,{onClick:_,disabled:!S||D,className:"w-full h-12 bg-primary hover:bg-primary/90 text-lg",children:[(0,t.jsx)(o.A,{className:(0,u.cn)("w-5 h-5 mr-2",D&&"animate-spin")}),D?"生成中... ".concat(F):"生成"]})})]}),(0,t.jsxs)("div",{className:"flex flex-col flex-1 bg-[#24222D] p-4",children:[(0,t.jsx)("div",{className:"flex justify-end mb-2",children:(0,t.jsxs)(x.$,{disabled:D,size:"sm",variant:"outline",onClick:$,className:(0,u.cn)("text-xs","bg-[#383842] border-[#4a4a54] text-white","hover:bg-[#FF3466] hover:border-[#FF3466] hover:text-white"),children:[(0,t.jsx)(d.A,{className:"w-4 h-4"}),"下载当前图片"]})}),(0,t.jsx)(m.i,{images:L,className:"flex-1",onCurrentChange:e=>{O(e)}})]})]})})]})}},1682:(e,l,a)=>{"use strict";a.d(l,{D:()=>u});var t=a(8045),s=a(5177),r=a(8227),i=a(3896),n=a(5086),c=a(6389),o=a(2989),d=a(9062);function u(e){let{onImageUpload:l,onImageRemove:a,className:u="",accept:h="image/*",maxSize:x=10,uploadedImage:m=null,disabled:v=!1}=e,b=(0,s.useRef)(null),[g,f]=(0,s.useState)(!1),[p,j]=(0,s.useState)(null),[N,y]=(0,s.useState)(!1),w=(0,s.useCallback)(e=>"image/*"!==h||e.type.startsWith("image/")?"video/*"!==h||e.type.startsWith("video/")?"image/*"===h||"video/*"===h||h.split(",").map(e=>e.trim()).some(l=>"*/*"===l||(l.endsWith("/*")?e.type.startsWith(l.slice(0,-2)):e.type===l))?e.size/1048576>x?"文件大小不能超过".concat(x,"MB"):null:"请上传支持的文件类型: ".concat(h):"请上传视频文件":"请上传图片文件",[x,h]),k=(0,s.useCallback)(async e=>{let a=w(e);if(a)return void j(a);j(null),y(!0);try{let a=await new Promise(l=>{if(!e.type.startsWith("image/"))return void l({});let a=new window.Image,t=URL.createObjectURL(e);a.onload=()=>{URL.revokeObjectURL(t),l({width:a.width,height:a.height})},a.onerror=()=>{URL.revokeObjectURL(t),l({})},a.src=t}),t=URL.createObjectURL(e),s=await new Promise((l,a)=>{let t=new FileReader;t.onload=()=>{"string"==typeof t.result?l(t.result):a(Error("转换base64失败"))},t.onerror=()=>a(Error("读取文件失败")),t.readAsDataURL(e)}),r={id:Date.now().toString(),file:e,url:t,base64:s,name:e.name,size:e.size,...a};null==l||l(r)}catch(e){console.error("文件处理失败:",e),j("文件处理失败，请重试")}finally{y(!1)}},[w,l]);return(0,t.jsxs)("div",{className:(0,c.cn)("w-full min-h-56",u),children:[m?(0,t.jsxs)("div",{className:"relative bg-[#383842] rounded-lg",children:[(0,t.jsx)(d.$,{onClick:()=>{m&&URL.revokeObjectURL(m.url),null==a||a(),j(null),y(!1)},size:"icon",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 bg-black/50 hover:bg-black/70 text-white z-10",disabled:v,children:(0,t.jsx)(r.A,{className:"w-4 h-4"})}),(0,t.jsx)("div",{className:"h-56 relative rounded-lg overflow-hidden bg-gray-700",children:m.file.type.startsWith("video/")?(0,t.jsx)("video",{src:m.url,className:"w-full h-full object-contain",controls:!0,preload:"metadata"}):(0,t.jsx)(o.default,{src:m.url,alt:m.name,fill:!0,className:"object-contain",unoptimized:!0})})]}):(0,t.jsx)("div",{className:(0,c.cn)("border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors","bg-[#383842] border-[#4a4a54]",g&&"border-primary bg-primary/10",(v||N)&&"cursor-not-allowed opacity-50",!v&&!N&&"hover:border-primary"),onDragOver:e=>{e.preventDefault(),v||N||f(!0)},onDragLeave:e=>{e.preventDefault(),f(!1)},onDrop:e=>{if(e.preventDefault(),f(!1),v||N)return;let l=e.dataTransfer.files;l&&l.length>0&&k(l[0])},onClick:()=>{if(!v&&!N){var e;null==(e=b.current)||e.click()}},children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("div",{className:(0,c.cn)("w-16 h-16 rounded-full flex items-center justify-center","bg-[#4a4a54]",g&&"bg-primary/20"),children:g?(0,t.jsx)(i.A,{className:"w-8 h-8 text-primary"}):(0,t.jsx)(n.A,{className:"w-8 h-8 text-gray-400"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-white font-medium",children:N?"video/*"===h?"正在处理视频...":"正在处理文件...":g?"video/*"===h?"松开以上传视频":"松开以上传文件":"video/*"===h?"点击上传视频":"点击上传文件"}),!N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"text-sm text-gray-400",children:["或将","video/*"===h?"视频":"文件","拖拽到此处"]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"video/*"===h?"支持 MP4、AVI、MOV 等格式，最大 ".concat(x,"MB"):"支持 JPG、PNG、WEBP 格式，最大 ".concat(x,"MB")})]})]})]})}),p&&(0,t.jsx)("div",{className:"mt-2 text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-2",children:p}),(0,t.jsx)("input",{ref:b,type:"file",accept:h,onChange:e=>{let l=e.target.files;l&&l.length>0&&k(l[0]),e.target.value=""},className:"hidden",disabled:v||N})]})}},3896:(e,l,a)=>{"use strict";a.d(l,{A:()=>t});let t=(0,a(4805).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},3962:(e,l,a)=>{Promise.resolve().then(a.bind(a,1181))},4234:(e,l,a)=>{"use strict";a.d(l,{i:()=>f});var t=a(8045),s=a(5177),r=a(2989),i=a(6389),n=a(251),c=a(4104),o=a(1977),d=a(9062);let u=s.createContext(null);function h(){let e=s.useContext(u);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}function x(e){let{orientation:l="horizontal",opts:a,setApi:r,plugins:c,className:o,children:d,...h}=e,[x,m]=(0,n.A)({...a,axis:"horizontal"===l?"x":"y"},c),[v,b]=s.useState(!1),[g,f]=s.useState(!1),p=s.useCallback(e=>{e&&(b(e.canScrollPrev()),f(e.canScrollNext()))},[]),j=s.useCallback(()=>{null==m||m.scrollPrev()},[m]),N=s.useCallback(()=>{null==m||m.scrollNext()},[m]),y=s.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),j()):"ArrowRight"===e.key&&(e.preventDefault(),N())},[j,N]);return s.useEffect(()=>{m&&r&&r(m)},[m,r]),s.useEffect(()=>{if(m)return p(m),m.on("reInit",p),m.on("select",p),()=>{null==m||m.off("select",p)}},[m,p]),(0,t.jsx)(u.Provider,{value:{carouselRef:x,api:m,opts:a,orientation:l||((null==a?void 0:a.axis)==="y"?"vertical":"horizontal"),scrollPrev:j,scrollNext:N,canScrollPrev:v,canScrollNext:g},children:(0,t.jsx)("div",{onKeyDownCapture:y,className:(0,i.cn)("relative",o),role:"region","aria-roledescription":"carousel","data-slot":"carousel",...h,children:d})})}function m(e){let{className:l,...a}=e,{carouselRef:s,orientation:r}=h();return(0,t.jsx)("div",{ref:s,className:"overflow-hidden","data-slot":"carousel-content",children:(0,t.jsx)("div",{className:(0,i.cn)("flex","horizontal"===r?"-ml-4":"-mt-4 flex-col",l),...a})})}function v(e){let{className:l,...a}=e,{orientation:s}=h();return(0,t.jsx)("div",{role:"group","aria-roledescription":"slide","data-slot":"carousel-item",className:(0,i.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===s?"pl-4":"pt-4",l),...a})}function b(e){let{className:l,variant:a="outline",size:s="icon",...r}=e,{orientation:n,scrollPrev:o,canScrollPrev:u}=h();return(0,t.jsxs)(d.$,{"data-slot":"carousel-previous",variant:a,size:s,className:(0,i.cn)("absolute size-8 rounded-full","horizontal"===n?"top-1/2 -left-12 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",l),disabled:!u,onClick:o,...r,children:[(0,t.jsx)(c.A,{}),(0,t.jsx)("span",{className:"sr-only",children:"Previous slide"})]})}function g(e){let{className:l,variant:a="outline",size:s="icon",...r}=e,{orientation:n,scrollNext:c,canScrollNext:u}=h();return(0,t.jsxs)(d.$,{"data-slot":"carousel-next",variant:a,size:s,className:(0,i.cn)("absolute size-8 rounded-full","horizontal"===n?"top-1/2 -right-12 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",l),disabled:!u,onClick:c,...r,children:[(0,t.jsx)(o.A,{}),(0,t.jsx)("span",{className:"sr-only",children:"Next slide"})]})}function f(e){let{images:l,className:a,onCurrentChange:n}=e,[c,o]=(0,s.useState)(),[d,u]=(0,s.useState)(0),[h,f]=(0,s.useState)(0),p=(0,s.useCallback)(()=>{if(!c)return;let e=c.selectedScrollSnap();u(e),null==n||n(e)},[c,n]);return(0,s.useEffect)(()=>{if(c)return c.on("select",p),f(c.scrollSnapList().length),p(),()=>{c.off("select",p)}},[c,l,p]),(0,t.jsx)("div",{className:(0,i.cn)("relative flex items-center justify-center",a),children:(0,t.jsxs)(x,{setApi:o,opts:{loop:!0},className:"w-full h-full h-full-carousel",children:[(0,t.jsx)(m,{className:"h-full",children:l.map(e=>(0,t.jsx)(v,{className:"h-full",children:(0,t.jsx)("div",{className:"p-1 h-full",children:(0,t.jsx)("div",{className:"relative h-full",children:(0,t.jsx)(r.default,{src:e.src,alt:e.alt||"Image ".concat(e.id),fill:!0,className:"h-full object-contain rounded-lg"})})})},e.id))}),l.length>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 p-2 rounded-full bg-primary hover:bg-primary/90 hover:text-white border-none text-white h-10 w-10"}),(0,t.jsx)(g,{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 p-2 rounded-full bg-primary hover:bg-primary/90 hover:text-white border-none text-white h-10 w-10"})]}),l.length>1&&(0,t.jsx)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2",children:Array.from({length:h}).map((e,l)=>(0,t.jsx)("button",{onClick:()=>null==c?void 0:c.scrollTo(l),className:(0,i.cn)("w-2 h-2 rounded-full bg-white/30 transition-colors",d===l?"bg-white":"hover:bg-white/50")},l))})]})})}}},e=>{e.O(0,[174,801,560,110,986,143,358],()=>e(e.s=3962)),_N_E=e.O()}]);