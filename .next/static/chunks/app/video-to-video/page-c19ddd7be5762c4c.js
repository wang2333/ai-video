(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[310],{7766:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>z});var s=t(8045),l=t(5177),r=t(7694),i=t(8247),n=t(6445),c=t(1574),d=t(6686),o=t(8365),m=t(6389),x=t(2989),h=t(9062),u=t(4310),g=t(8227),p=t(3896),v=t(8768);function j(e){let{onFileSelect:a,onVideoRemove:t,className:r="",uploadedVideo:i=null,disabled:n=!1,error:c=null,isUploading:d=!1,uploadProgress:o=null}=e,x=(0,l.useRef)(null),[u,j]=(0,l.useState)(!1),f=e=>{null==a||a(e)};return(0,s.jsxs)("div",{className:(0,m.cn)("w-full",r),children:[i?(0,s.jsxs)("div",{className:"relative bg-[#383842] rounded-lg",children:[(0,s.jsx)(h.$,{onClick:()=>{null==t||t()},size:"icon",variant:"ghost",className:"absolute top-2 right-2 h-8 w-8 bg-black/50 hover:bg-black/70 text-white z-10",disabled:n,children:(0,s.jsx)(g.A,{className:"w-4 h-4"})}),(0,s.jsx)("div",{className:"h-56 relative rounded-lg overflow-hidden bg-gray-700",children:(0,s.jsx)("video",{src:i.uploadUrl||i.url,className:"w-full h-full object-contain",controls:!0,preload:"metadata"})})]}):(0,s.jsx)("div",{className:(0,m.cn)("border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors","bg-[#383842] border-[#4a4a54]",u&&"border-primary bg-primary/10",(n||d)&&"cursor-not-allowed opacity-50",!n&&!d&&"hover:border-primary"),onDragOver:e=>{e.preventDefault(),n||d||j(!0)},onDragLeave:e=>{e.preventDefault(),j(!1)},onDrop:e=>{if(e.preventDefault(),j(!1),n||d)return;let a=e.dataTransfer.files;a&&a.length>0&&f(a[0])},onClick:()=>{if(!n&&!d){var e;null==(e=x.current)||e.click()}},children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:(0,m.cn)("w-16 h-16 rounded-full flex items-center justify-center","bg-[#4a4a54]",u&&"bg-primary/20"),children:u?(0,s.jsx)(p.A,{className:"w-8 h-8 text-primary"}):(0,s.jsx)(v.A,{className:"w-8 h-8 text-gray-400"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-white font-medium",children:d?o?"上传中... ".concat(o.percent,"%"):"正在处理视频...":u?"松开以上传视频":"点击上传视频"}),!d&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"text-sm text-gray-400",children:"或将视频文件拖拽到此处"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"支持常见的视频格式"})]}),d&&o&&(0,s.jsx)("div",{className:"w-full bg-gray-700 rounded-full h-2 mt-3",children:(0,s.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(o.percent,"%")}})})]})]})}),c&&(0,s.jsx)("div",{className:"mt-2 text-sm text-red-400 bg-red-500/10 border border-red-500/20 rounded-lg p-3",children:c}),(0,s.jsx)("input",{ref:x,type:"file",accept:"video/*",onChange:e=>{let a=e.target.files;a&&a.length>0&&f(a[0]),e.target.value=""},className:"hidden",disabled:n||d})]})}var f=t(9009),b=t(8225),y=t(3677),N=t(7803),w=t(7148);let k=[{id:0,name:"日式漫画",description:"日本动漫风格，线条清晰，色彩鲜艳",image:"/image/style1.jpg"},{id:1,name:"美式漫画",description:"美国漫画风格，色彩饱和，线条粗犷",image:"/image/style2.jpg"},{id:2,name:"清新漫画",description:"清新淡雅的漫画风格，色调柔和",image:"/image/style3.jpg"},{id:3,name:"3D卡通",description:"三维卡通风格，立体感强",image:"/image/style4.jpg"},{id:4,name:"国风卡通",description:"中国风卡通，传统文化元素",image:"/image/style5.jpg"},{id:5,name:"纸艺风格",description:"纸艺剪纸风格，层次分明",image:"/image/style6.jpg"},{id:6,name:"简易插画",description:"简约插画风格，线条简洁",image:"/image/style7.jpg"},{id:7,name:"国风水墨",description:"中国水墨画风格，意境深远",image:"/image/style8.jpg"}],S=[{value:"video-style-transform",label:"通义万相",description:"视频风格重绘",icon:"/image/Group.svg"}],C=[{value:15,label:"15 FPS",description:"标准帧率"},{value:20,label:"20 FPS",description:"电影级帧率"},{value:25,label:"25 FPS",description:"高帧率"}];function z(){let{uploadedVideo:e,isUploading:a,error:t,uploadProgress:g,handleFileSelect:p,removeVideo:v}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[a,t]=(0,l.useState)(null),[s,r]=(0,l.useState)(!1),[i,n]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),o=(0,l.useCallback)(e=>e.type.startsWith("video/")?e.size>524288e3?"文件大小不能超过500MB":null:"请选择视频文件",[]),m=(0,l.useCallback)(e=>new Promise((a,t)=>{let s=document.createElement("video"),l=URL.createObjectURL(e);s.onloadedmetadata=()=>{URL.revokeObjectURL(l),a({width:s.videoWidth,height:s.videoHeight,duration:s.duration})},s.onerror=()=>{URL.revokeObjectURL(l),t(Error("无法读取视频信息"))},s.src=l}),[]),x=(0,l.useCallback)(async()=>{let e=await fetch("/api/qiniu/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!e.ok)throw Error("获取上传凭证失败: ".concat(e.status));let a=await e.json();if(!a.success)throw Error(a.error||"获取上传凭证失败");return a.data},[]),h=(0,l.useCallback)((e,a)=>{let t;if(!e||!a)throw Error("域名或文件key缺失");return t=e.startsWith("http")?e:e.includes("clouddn.com")||e.includes("qiniudn.com")||e.includes("bkt.clouddn.com")?"http://".concat(e):"https://".concat(e),"".concat(t,"/").concat(a)},[]),u=(0,l.useCallback)(async a=>{let{token:t,key:s,domain:l,zone:r}=await x(),i={fname:a.name,params:{"x:name":a.name}},n={useCdnDomain:!0,region:(e=>{switch(e){case"z0":return f.Ny.z0;case"z1":return f.Ny.z1;case"z2":default:return f.Ny.z2;case"na0":return f.Ny.na0;case"as0":return f.Ny.as0}})(r||"z2")};return new Promise((r,c)=>{f.Se(a,s,t,i,n).subscribe({next:a=>{if(a.total){var t;let s={loaded:a.total.loaded,total:a.total.size,percent:Math.round(a.total.loaded/a.total.size*100)};d(s),null==(t=e.onProgress)||t.call(e,s)}},error:e=>{c(Error((null==e?void 0:e.message)||(null==e?void 0:e.err)||"上传失败"))},complete:e=>{try{let a=h(l,e.key);r(a)}catch(e){c(e)}}})})},[x,h,e]),g=(0,l.useCallback)(async a=>{var s,l;let i=o(a);if(i)return void n(i);n(null),r(!0),d(null);try{let l=await m(a),r=URL.createObjectURL(a),i=await u(a),n={id:Date.now().toString(),file:a,url:r,name:a.name,size:a.size,duration:l.duration,width:l.width,height:l.height,uploadUrl:i};t(n),null==(s=e.onSuccess)||s.call(e,i)}catch(t){let a=t instanceof Error?t.message:"上传失败，请重试";n(a),null==(l=e.onError)||l.call(e,a)}finally{r(!1),d(null)}},[o,m,u,e]),p=(0,l.useCallback)(()=>{a&&URL.revokeObjectURL(a.url),t(null),n(null),d(null)},[a]);return{uploadedVideo:a,isUploading:s,error:i,uploadProgress:c,handleFileSelect:g,removeVideo:p}}({onSuccess:e=>{console.log("视频上传成功:",e)},onError:e=>{console.error("视频上传失败:",e)}}),{formattedDuration:z,isRunning:U,start:D,stop:E,reset:R}=(0,w.g)(),[L,A]=(0,l.useState)("video-style-transform"),[F,O]=(0,l.useState)(0),[P,_]=(0,l.useState)(15),[M,T]=(0,l.useState)(!1),[B,I]=(0,l.useState)([{id:1,src:"/demo.mp4"}]),[V,$]=(0,l.useState)(null),[W,q]=(0,l.useState)(0),G=["mp4","avi","mkv","mov","flv","ts","mpg","mxf"],H=async a=>{if($(null),await p(a),e){let a=(e=>{var a;let t=null==(a=e.name.split(".").pop())?void 0:a.toLowerCase();if(!t||!G.includes(t))return"不支持的视频格式。支持格式：".concat(G.join(", "));let s=e.size/1048576;if(s>100)return"文件大小不能超过".concat(100,"MB，当前大小：").concat(s.toFixed(2),"MB");if(e.width&&e.height){if(e.width<256||e.height<256)return"视频分辨率过小。最小尺寸：".concat(256,"\xd7").concat(256,"，当前尺寸：").concat(e.width,"\xd7").concat(e.height);if(e.width>4096||e.height>4096)return"视频分辨率过大。最大尺寸：".concat(4096,"\xd7").concat(4096,"，当前尺寸：").concat(e.width,"\xd7").concat(e.height);let a=Math.max(e.width,e.height)/Math.min(e.width,e.height);if(a>1.8)return"视频长宽比超出限制。最大比例：".concat(1.8,":1，当前比例：").concat(a.toFixed(2),":1")}return e.duration&&e.duration>30?"视频时长超出限制。最大时长：".concat(30,"秒，当前时长：").concat(Math.round(e.duration),"秒"):null})(e);a&&($(a),v())}},J=async()=>{let a=e?e.uploadUrl?null:"视频文件尚未上传完成，请稍候":"请先上传视频文件";if(a)return void $(a);T(!0),$(null),D();try{let a=await (0,N.Zn)({model:L,video_url:e.uploadUrl||"",style:F,video_fps:P});a.success&&a.data?(I([{id:Date.now(),src:a.data.output.output_video_url}]),q(0)):$(a.error||"提交视频生成任务失败")}catch(e){$(e instanceof Error?e.message:"生成视频时发生未知错误")}finally{T(!1),E()}},Z=async()=>{if(0!==B.length)try{await (0,y.rT)(B,W)}catch(e){console.error("下载失败:",e),$("下载失败，请重试")}};return(0,s.jsxs)("div",{className:"bg-[#0D0D12] min-h-screen text-white",children:[(0,s.jsx)(r.A,{}),(0,s.jsx)(i.A,{}),(0,s.jsx)("main",{className:"ml-20 pt-14",children:(0,s.jsxs)("div",{className:"flex h-[calc(100vh-56px)] p-4 gap-4",children:[(0,s.jsxs)("div",{className:"w-[380px] bg-[#24222D] p-4 flex flex-col",children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-6",children:[(0,s.jsx)("h1",{className:"text-xl",children:"视频转视频AI"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"模型选择"}),(0,s.jsx)(b.t,{options:S.map(e=>({value:e.value,label:e.label,description:e.description,icon:e.icon})),value:L,onValueChange:A,variant:"dark",size:"lg",renderTrigger:e=>e?(0,s.jsxs)("div",{className:"flex items-center gap-3 py-1",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg bg-gray-700 flex items-center justify-center",children:(0,s.jsx)(x.default,{src:e.icon||"/image/com-logo-hunyuan.svg",alt:e.label,width:24,height:24,unoptimized:!0})}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm text-white",children:e.label}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})]}):null,renderItem:e=>(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-md bg-gray-700 flex items-center justify-center",children:(0,s.jsx)(x.default,{src:e.icon||"/image/com-logo-hunyuan.svg",alt:e.label,width:20,height:20,unoptimized:!0})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:e.label}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"上传视频"}),(0,s.jsx)(j,{onFileSelect:H,onVideoRemove:()=>{v(),$(null)},uploadedVideo:e,disabled:M,error:t||V,isUploading:a,uploadProgress:g}),(null==e?void 0:e.uploadUrl)&&(0,s.jsx)("div",{className:"mt-2 text-sm text-green-400 bg-green-500/10 border border-green-500/20 rounded-lg p-3",children:"✓ 视频已成功上传"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"风格选择"}),(0,s.jsx)(b.t,{options:k.map(e=>({value:e.id.toString(),label:e.name,description:e.description,icon:e.image})),value:F.toString(),onValueChange:e=>O(parseInt(e)),variant:"dark",size:"lg",renderTrigger:e=>e?(0,s.jsx)("div",{className:"flex items-center gap-3 py-1",children:(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("p",{className:"text-sm text-white",children:e.label}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})}):null,renderItem:e=>(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white",children:e.label}),(0,s.jsx)("p",{className:"text-xs text-gray-400",children:e.description})]})})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-gray-300 mb-2",children:"视频帧率"}),(0,s.jsx)("div",{className:"flex gap-2",children:C.map(e=>(0,s.jsxs)(h.$,{variant:P===e.value?"default":"outline",onClick:()=>_(e.value),className:(0,m.cn)("flex-1 flex-col h-auto py-2",P===e.value?"bg-primary hover:bg-primary/90":"bg-[#383842] border-[#4a4a54] hover:bg-[#4a4a54] hover:text-white"),children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:e.label}),(0,s.jsx)("span",{className:"text-xs opacity-70",children:e.description})]},e.value))})]}),(0,s.jsxs)("div",{className:"bg-[#383842] rounded-lg p-3 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-300",children:[(0,s.jsx)(n.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"视频要求"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[(0,s.jsxs)("p",{children:["• 支持格式：",G.join(", ")]}),(0,s.jsxs)("p",{children:["• 文件大小：不超过 ",100,"MB"]}),(0,s.jsxs)("p",{children:["• 视频时长：不超过 ",30,"秒"]}),(0,s.jsxs)("p",{children:["• 分辨率：",256,"-",4096,"px，长宽比不超过 ",1.8,":1"]})]})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-400",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{children:"所需额度:"}),(0,s.jsx)(n.A,{className:"w-4 h-4"})]}),(0,s.jsx)("span",{className:"text-white",children:"video-style-transform-pro"===L?"200 额度":"video-style-transform-fast"===L?"50 额度":"100 额度"})]})]}),V&&(0,s.jsxs)("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-3 flex items-start gap-2 mb-4",children:[(0,s.jsx)(c.A,{className:"w-4 h-4 text-red-400 mt-0.5 flex-shrink-0"}),(0,s.jsx)("div",{className:"text-sm text-red-400",children:V})]}),U&&(0,s.jsx)("div",{className:"bg-[#383842] rounded-lg p-3 mb-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-300",children:"生成进度"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-lg font-mono text-primary",children:z})]})]})}),(0,s.jsx)("div",{className:"pt-4 border-t border-gray-700",children:(0,s.jsxs)(h.$,{onClick:J,disabled:!e||!e.uploadUrl||M,className:"w-full h-12 bg-primary hover:bg-primary/90 text-lg",children:[(0,s.jsx)(d.A,{className:(0,m.cn)("w-5 h-5 mr-2",M&&"animate-spin")}),M?"生成中... ".concat(z):"生成视频"]})})]}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 bg-[#24222D] p-4",children:[(0,s.jsx)("div",{className:"flex justify-end mb-2",children:(0,s.jsxs)(h.$,{disabled:M,size:"sm",variant:"outline",onClick:Z,className:(0,m.cn)("text-xs","bg-[#383842] border-[#4a4a54] text-white","hover:bg-[#FF3466] hover:border-[#FF3466] hover:text-white"),children:[(0,s.jsx)(o.A,{className:"w-4 h-4"}),"下载当前视频"]})}),(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center min-h-0 overflow-hidden",children:(0,s.jsx)(u.s,{videos:B,className:"w-full h-full max-w-full max-h-full",onCurrentChange:e=>{q(e)},autoPlay:!0,showThumbnails:!0})})]})]})})]})}},9494:(e,a,t)=>{Promise.resolve().then(t.bind(t,7766))}},e=>{e.O(0,[174,801,1,110,929,986,143,358],()=>e(e.s=9494)),_N_E=e.O()}]);